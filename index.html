<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interaktiver Emotionstracker</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Webfonts (f√ºr die App-Ansicht) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600&family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
  <!-- PDF-Erzeugung -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root { color-scheme: light; }
    body { font-family: 'Heebo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: linear-gradient(135deg, #f0f8f8 0%, #e0f2f2 100%); }
    h1, h2, h3, h4, .heading { font-family: 'Caveat', cursive; }
    label, button, select, summary, input, textarea { font-family: 'Heebo', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .toskana-green { color: #008B8B; }
    .toskana-green-bg { background-color: #008B8B; }
    .gradient-header { background: linear-gradient(135deg, #008B8B 0%, #20B2AA 50%, #48D1CC 100%); }
    @page { size: A4; margin: 16mm; }
    /* ...restliche CSS wie im Prompt... */
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <div class="gradient-header text-white p-8 rounded-t-lg text-center">
      <div class="text-5xl mb-4">üß≠</div>
      <h1 class="heading text-3xl mb-2">Interaktiver Emotionstracker</h1>
      <p class="text-base opacity-90 mb-4">Der Emotionstracker ist <strong>kostenfrei, aber nur mit Registrierung</strong> nutzbar. Er dient als pers√∂nliches Tagebuch und Monitoring-Tool: zur Selbstbeobachtung, zur Unterst√ºtzung vor oder w√§hrend einer Psychotherapie ‚Äì oder einfach, um die eigene Entwicklung im Blick zu behalten. Das Tool ersetzt keine Therapie und ist ohne Gew√§hr. Bitte wende Dich an Deine Eltern, Vertrauenspersonen oder Therapeuten, wenn Du gro√üe Sorgen hast! </p>
      <div class="bg-white bg-opacity-20 rounded-lg p-4 text-left text-sm">
        <h3 class="heading text-lg mb-3 text-center">üìã So funktioniert's:</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="mb-2"><strong>üíæ Registrierung:</strong> F√ºr die Nutzung ist eine einmalige Registrierung erforderlich.</p>
            <p class="mb-2"><strong>üíæ Speicherung:</strong> Alle Daten werden nur in deinem Browser gespeichert - nirgendwo anders!</p>
            <p class="mb-2"><strong>‚ö†Ô∏è Wichtig:</strong> L√∂sche nicht den Browserverlauf/Cache, sonst sind deine Eintr√§ge weg!</p>
            <p class="mb-2"><strong>üîí Privatsph√§re:</strong> Mehrere Personen k√∂nnen gleichzeitig nutzen - jeder sieht nur seine eigenen Daten.</p>
          </div>
          <div>
            <p class="mb-2"><strong>üñ®Ô∏è Tagebuch drucken:</strong> W√§hle Eintr√§ge aus und drucke sie als pers√∂nliches Tagebuch.</p>
            <p class="mb-2"><strong>üìÑ PDF/Teilen:</strong> Erzeuge ein PDF und teile es manuell z. B. per E-Mail oder Messenger. Du kannst es auch mit Deinem Therapeuten teilen!</p>
            <p class="mb-2"></p>
          </div>
        </div>
      </div>
    </div>
    <!-- Formular, Auswertung, Eintr√§ge und Buttons -->
    <div class="bg-white rounded-lg p-6 shadow-md">
      <!-- ...hier kommt der vollst√§ndige HTML-Block f√ºr das Formular, die Auswertung und die Eintragsliste hin (wie im Prompt)... -->
    </div>
  </div>
  <script>
    // ---------- LocalStorage robust behandeln (Private Mode iOS) ----------
    function safeGetLocalStorage(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch(e){ return fallback; }
    }
    function safeSetLocalStorage(key, value) {
      try { localStorage.setItem(key, JSON.stringify(value)); return true; } catch(e){ console.warn('localStorage nicht verf√ºgbar:', e); return false; }
    }

    // Globale Variablen
    let currentEmotions = {};
    let entries = safeGetLocalStorage('moodEntries', []);

    // Initialisierung
    document.addEventListener('DOMContentLoaded', function() {
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('dateTime').value = now.toISOString().slice(0, 16);
      setupEventListeners();
      displayEntries();
      // Button f√ºr PDF-Export auf neue Funktion setzen
      const btnPDF = document.getElementById('btnPDF');
      if (btnPDF) {
        btnPDF.onclick = exportVisibleDiaryAsPDF;
      }
    });

    // ---------- PDF/Print Helfer ----------
    function exportVisibleDiaryAsPDF() {
      // W√§hle einen speziellen Export-Container, der NUR die Eintr√§ge und Auswertung enth√§lt
      let exportArea = document.getElementById('exportArea');
      if (!exportArea) {
        // Wenn nicht vorhanden, dynamisch erzeugen
        exportArea = document.createElement('div');
        exportArea.id = 'exportArea';
        exportArea.style.background = '#fff';
        exportArea.style.padding = '24px';
        exportArea.style.borderRadius = '16px';
        exportArea.style.maxWidth = '900px';
        exportArea.style.margin = '0 auto';
        // Titel und Name
        const username = (document.getElementById('printName')?.value || '').trim();
        const today = new Date().toLocaleDateString('de-DE');
        exportArea.innerHTML = `<div style='text-align:center;font-size:2em;color:#008B8B;font-family:Caveat,cursive;margin-bottom:12px;'>Emotionstagebuch${username ? ' ‚Äì ' + username : ''}</div>`;
        // Auswertung
        const analysis = document.getElementById('analysisSection');
        if (analysis) {
          exportArea.innerHTML += `<div>${analysis.innerHTML}</div>`;
        }
        // Eintr√§ge
        const entries = document.getElementById('entriesList');
        if (entries) {
          exportArea.innerHTML += `<div style='margin-top:24px;'>${entries.innerHTML}</div>`;
        }
        document.body.appendChild(exportArea);
      }
      // PDF-Optionen
      const opt = {
        margin: [10, 10, 14, 10],
        filename: `emotionstagebuch-${(new Date()).toISOString().split('T')[0]}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 1.5, backgroundColor: '#ffffff' },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak: { mode: ['css', 'legacy'] }
      };
      html2pdf().set(opt).from(exportArea).save().then(() => {
        // Nach Export wieder entfernen, damit nichts doppelt ist
        if (exportArea && exportArea.id === 'exportArea') exportArea.remove();
      });
    }

    // ...hier folgt der vollst√§ndige JavaScript-Code f√ºr die Eintragsverwaltung, Anzeige, PDF- und Druckfunktion wie im Prompt...
  </script>
</body>
</html>
